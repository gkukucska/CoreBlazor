@inject IEnumerable<DiscoveredContext> DiscoveredContexts
@using BlazorBootstrap
@using CoreBlazor.Configuration
<Sidebar2 Title="CoreBlazor"
         BadgeText="1.0.0"
         DataProvider="SidebarDataProvider"
         WidthUnit="Unit.Px" />
@code {

    private IEnumerable<NavItem>? _navItems;

    private async Task<Sidebar2DataProviderResult> SidebarDataProvider(Sidebar2DataProviderRequest request)
    {
        _navItems ??= GetNavItems();

        return await Task.FromResult(request.ApplyTo(_navItems));
    }

    private IEnumerable<NavItem> GetNavItems()
    {
        foreach (var context in DiscoveredContexts ?? [])
        {
            ConfigurationHelper.DisplayTitles.TryGetValue(context.ContextType.Name, out var contextTitle);
            contextTitle = contextTitle ?? context.ContextType.Name;
            yield return new NavItem()
            {
                Text = contextTitle,
                IconName = IconName.DatabaseFill,
                Id = context.ContextType.Name
            };
            yield return new NavItem()
            {
                Text = "Info",
                IconName = IconName.InfoCircle,
                Id = context.ContextType.Name+"info",
                Href = $"DbContext/{context.ContextType.Name}/Info",
                ParentId = context.ContextType.Name
            };

            foreach (var set in context.Sets)
            {

                ConfigurationHelper.DisplayTitles.TryGetValue(set.EntityType.Name, out var setTitle);
                setTitle = setTitle ?? set.EntityType.Name;
                yield return new NavItem()
                {
                    Text = setTitle,
                    IconName = IconName.Table,
                    Id = context.ContextType.Name+ set.EntityType.Name,
                    Href = $"DbContext/{context.ContextType.Name}/DbSet/{set.EntityType.Name}",
                    ParentId = context.ContextType.Name
                };
            }
        }
    }
}