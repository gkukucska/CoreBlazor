@using System.Reflection
@using CoreBlazor.Configuration
@using CoreBlazor.Interfaces
@using Microsoft.EntityFrameworkCore
@using Microsoft.Extensions.DependencyInjection
@typeparam TContext where TContext : DbContext
@typeparam TEntity where TEntity : class
@typeparam TProperty where TProperty : class
@inject IServiceProvider ServiceProvider

@if (DbSetOptions?.ComponentDisplay is not null)
{
    <DynamicComponent Type="DbSetOptions.ComponentDisplay" Parameters="new Dictionary<string, object>() { { nameof(IEntityDisplayComponent<TProperty>.Entity), _propertyInfo.GetValue(Entity) } }" />
}
else if (DbSetOptions?.StringDisplay is not null)
{
    DbSetOptions.StringDisplay.Invoke(_propertyInfo.GetValue(Entity) as TProperty);
}
else
{
    _propertyInfo.GetValue(Entity);
}

@code {
    private PropertyInfo _propertyInfo;

    public CoreBlazorDbSetOptions<TContext, TProperty>? DbSetOptions { get; set; }

    [Parameter]
    public TEntity Entity { get; set; }

    [Parameter]
    public string PropertyName { get; set; }

    protected override void OnParametersSet()
    {
        DbSetOptions = ServiceProvider.GetService<CoreBlazorDbSetOptions<TContext, TProperty>>();
        _propertyInfo = typeof(TEntity).GetProperty(PropertyName, typeof(TProperty));
        base.OnParametersSet();
    }
}
